<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        /* Adicionando estilo para o mapa */
        #map {
            height: 500px;
            /* Altura do mapa */
            width: 100%;
            /* Largura do mapa */
            margin-top: 20px;
            /* Espaço acima do mapa */
        }

        /* Estilos para a barra de pesquisa */
        #search-container {
            margin-top: 20px;
        }

        #search-input {
            padding: 10px;
            width: 80%;
            /* Largura da caixa de pesquisa */
            font-size: 14px;
        }

        #search-button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            background-image: linear-gradient(#1c021d, #730b77, #260727);
            font-weight: bold;
            color: white;
            border-radius: 5px;
            border: none;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <img src="img/logo-Bag.png" alt="">
        <ul>

            <li><a href="dashboard.html">Viajar GPS</a> <i class="bi bi-geo-alt"></i></li>
            <li><a href="explorar_destinos.html">Explorar Destinos</a> <i class="bi bi-map"></i></li>
            <li><a href="dicas_viagem.html">Dicas de Viagem</a> <i class="bi bi-lightbulb"></i></li>
            <li><a href="sos.html">Ligar Emergência Local</a> <i class="bi bi-telephone"></i></li>
            <li><a href="faq.html">Suporte/FAQ</a> <i class="bi bi-question-circle"></i></li>
            <li><a href="config.html">Configurações de conta</a> <i class="bi bi-gear"></i></li>
            <li><a href="index.html">Sair</a> <i class="bi bi-box-arrow-right"></i></li>

        </ul>
    </div>
    <div class="content">
        <h1>Bem-vindo ao seu guia turístico virtual</h1>
        <p>Para onde gostaria de ir?</p>

        <!-- Barra de Pesquisa -->
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Digite um destino...">
            <button id="search-button" onclick="buscarLocal()">Buscar</button>
        </div>

        <div id="resultado"></div> <!-- Para exibir os resultados da busca -->
        <div id="map"></div> <!-- Elemento para o mapa -->
    </div>

    <script>
        // Inicializa o mapa
        const map = L.map('map').setView([-23.5505, -46.6333], 2); // Ponto inicial do mapa

        // Adiciona uma camada de tiles do OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Função para buscar local
        async function buscarLocal() {
            const local = document.getElementById('search-input').value; // Busca o valor da barra de pesquisa
            if (!local) {
                alert('Por favor, digite um destino para buscar.');
                return;
            }
            const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(local)}&format=json&addressdetails=1&limit=1`;

            try {
                const resposta = await fetch(url);
                const dados = await resposta.json();

                // Exibir os dados no conteúdo
                const resultadoDiv = document.getElementById('resultado');
                resultadoDiv.innerHTML = ''; // Limpa resultados anteriores

                // Remove marcadores existentes
                map.eachLayer(function (layer) {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });

                if (dados.length > 0) {
                    const l = dados[0]; // Pega a primeira localização retornada
                    const p = document.createElement('p');
                    p.textContent = `Nome: ${l.display_name}, Latitude: ${l.lat}, Longitude: ${l.lon}`;
                    resultadoDiv.appendChild(p);

                    // Adiciona um marcador para a localização encontrada
                    const marker = L.marker([l.lat, l.lon]).addTo(map);
                    marker.bindPopup(l.display_name).openPopup();

                    // Move o mapa para a nova localização
                    map.setView([l.lat, l.lon], 13); // Ajuste o zoom para melhor visualização
                } else {
                    resultadoDiv.innerHTML = 'Nenhum resultado encontrado.';
                }
            } catch (erro) {
                console.error('Erro ao buscar local:', erro);
                alert('Ocorreu um erro ao buscar o local. Tente novamente.');
            }
        }

        // Verifica se a página foi carregada com parâmetros de latitude e longitude
        const urlParams = new URLSearchParams(window.location.search);
        const lat = urlParams.get('lat');
        const lon = urlParams.get('lon');

        // Se lat e lon estão definidos, centralize o mapa
        if (lat && lon) {
            map.setView([lat, lon], 13); // Ajusta o zoom para melhor visualização
            const marker = L.marker([lat, lon]).addTo(map);
            marker.bindPopup('Você está aqui!').openPopup();
        }
    </script>
</body>

</html>